<!doctype html><html><head><title>Vulkan Grass Rendering</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/navigators/navbar.css><link rel=stylesheet href=/css/plyr.css><link rel=stylesheet href=/css/flag-icon.min.css><link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css><link rel=icon type=image/png href=/images/site/favicon-32x32-ZR_hu8be55ec36a526970238b8207e0c8eab8_2764_42x0_resize_box_2.png><meta property="og:title" content="Vulkan Grass Rendering"><meta property="og:description" content="Tested on: Windows 10 Home 21H1 Build 19043.1288, Ryzen 7 3700X @ 3.59GHz 48GB, RTX 2060 Super 8GB  Highlights This project implements physically-based grass rendering & culling with Vulkan compute shaders:
 Physically-based real-time rendering of grass blades; 3 different culling tests: orientation culling, view-frustum culling, distance culling; Tessellating Bezier curves into grass blades with GLSL tessellation shader  A detailed instruction of this project can be found here."><meta property="og:type" content="article"><meta property="og:url" content="https://zhihaoruan.xyz/posts/projects/565-vulkan-grass-rendering/"><meta property="article:published_time" content="2021-12-27T00:54:07+00:00"><meta property="article:modified_time" content="2021-12-27T00:54:07+00:00"><meta name=description content="Vulkan Grass Rendering"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css><link rel=stylesheet href=/css/style.css></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/>Ryan's Blog</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"></ul></div></div></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><a href=/posts/introduction/ title=Introduction>Introduction</a></li><li><i class="fas fa-plus-circle"></i><a href=/posts/lecturenotes/>Lecture Notes</a><ul><li><a href=/posts/lecturenotes/ve320-notes/ title="VE320 Course Final Summary">VE320 Course Final Summary</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/gallery/>My Personal Gallery</a><ul><li><a href=/posts/gallery/ann-arbor/ title="Ann Arbor">Ann Arbor</a></li><li><a href=/posts/gallery/blue-hour/ title="Blue Hour">Blue Hour</a></li><li><a href=/posts/gallery/covid-19/ title="Capturing COVID-19">Capturing COVID-19</a></li><li><a href=/posts/gallery/hong-kong/ title="Hong Kong">Hong Kong</a></li><li><a href=/posts/gallery/dublin/ title=Ireland>Ireland</a></li><li><a href=/posts/gallery/london/ title=London>London</a></li><li><a href=/posts/gallery/michigan/ title=Michigan>Michigan</a></li><li><a href=/posts/gallery/zhuhai/ title=Zhuhai>Zhuhai</a></li></ul></li><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/projects/>Projects</a><ul class=active><li><a href=/posts/projects/565-cuda-path-tracer/ title="CUDA Path Tracer">CUDA Path Tracer</a></li><li><a href=/posts/projects/373proj/ title="EECS 373 Project">EECS 373 Project</a></li><li><a href=/posts/projects/560proj/ title="Mini Minecraft">Mini Minecraft</a></li><li><a href=/posts/projects/450proj/ title="SJTU Undergraduate Design Expo">SJTU Undergraduate Design Expo</a></li><li><a href=/posts/projects/467proj-slam/ title="SLAM Project">SLAM Project</a></li><li><a href=/posts/projects/565-final-project/ title="Volume Rendered ReSTIR">Volume Rendered ReSTIR</a></li><li><a class=active href=/posts/projects/565-vulkan-grass-rendering/ title="Vulkan Grass Rendering">Vulkan Grass Rendering</a></li><li><i class="fas fa-plus-circle"></i><a href=/posts/projects/f1tenth-labs/>F1Tenth Course Labs</a><ul><li><a href=/posts/projects/f1tenth-labs/f1tenth-lab1/ title="F1Tenth Course Lab 1">F1Tenth Course Lab 1</a></li><li><a href=/posts/projects/f1tenth-labs/f1tenth-lab2/ title="F1Tenth Course Lab 2">F1Tenth Course Lab 2</a></li><li><a href=/posts/projects/f1tenth-labs/f1tenth-lab3/ title="F1Tenth Course Lab 3">F1Tenth Course Lab 3</a></li><li><a href=/posts/projects/f1tenth-labs/f1tenth-lab4/ title="F1Tenth Course Lab 4">F1Tenth Course Lab 4</a></li><li><a href=/posts/projects/f1tenth-labs/f1tenth-lab6/ title="F1Tenth Course Lab 6">F1Tenth Course Lab 6</a></li></ul></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/journals/>Travel Journals</a><ul><li><a href=/posts/journals/phuket-journal/ title="Phuket Journal">Phuket Journal</a></li><li><a href=/posts/journals/puerto-rico-journal/ title="Puerto Rico's Journal">Puerto Rico's Journal</a></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(https://zhihaoruan.xyz/images/posts/565-vulkan-grass-rendering/blade_upstraight.png)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/avatar_hufa2498ddc73a49f179638934ba5c8634_1773717_120x120_fit_q75_box.jpg alt="Author Image"><h5 class=author-name>Zhihao (Ryan) Ruan</h5><p>December 27, 2021</p></div><div class=title><h1>Vulkan Grass Rendering</h1></div><div class=post-content id=post-content><ul><li>Tested on: Windows 10 Home 21H1 Build 19043.1288, Ryzen 7 3700X @ 3.59GHz 48GB, RTX 2060 Super 8GB</li></ul><p><img src=overall.gif alt></p><h3 id=highlights>Highlights</h3><p>This project implements physically-based grass rendering & culling with Vulkan compute shaders:</p><ul><li>Physically-based real-time rendering of grass blades;</li><li>3 different culling tests: orientation culling, view-frustum culling, distance culling;</li><li>Tessellating Bezier curves into grass blades with GLSL tessellation shader</li></ul><p>A detailed instruction of this project can be found <a href=INSTRUCTION.md>here</a>.</p><h3 id=vulkan>Vulkan</h3><p><a href=https://vulkan-tutorial.com/>Vulkan</a> is considered as the next-generation graphics API developed by <a href=https://www.khronos.org/>Khronos group</a>, in replacement for the old OpenGL. It is fast, high-performance, and cross-platform. However, the downside of this API is that it exposes all details of GPU hardware to users for possible customization, so that it generally takes a significantly large amount of code for users to set up the rendering pipeline than OpenGL.</p><p>This project sets up a standard Vulkan graphics pipeline with compute shaders & tessellation shaders. The goal of this project is to implement the paper <a href=https://www.cg.tuwien.ac.at/research/publications/2017/JAHRMANN-2017-RRTG/JAHRMANN-2017-RRTG-draft.pdf>Responsive Real-Time Grass Rendering for General 3D Scenes</a> for effective grass simulation in 3D rendering.</p><h3 id=responsive-real-time-grass-rendering-for-general-3d-sceneshttpswwwcgtuwienacatresearchpublications2017jahrmann-2017-rrtgjahrmann-2017-rrtg-draftpdf><a href=https://www.cg.tuwien.ac.at/research/publications/2017/JAHRMANN-2017-RRTG/JAHRMANN-2017-RRTG-draft.pdf>Responsive Real-Time Grass Rendering for General 3D Scenes</a></h3><p>Grass is a critical component in 3D graphics. Almost every modern video games have some scenes that involve the rendering of grass. It is also a typical example of massive parallelization, as with the power of GPU one can easily think of ways to render every grass blade with a single GPU thread for photorealistic effects. However, approximations are still needed, and the paper chooses Bezier curves. Bezier curves are a special family of curve that produces smooth splines geometry in 3D space. The generation of Bezier curve requires pre-defining multiple control points, and the curve would then be generated following a fixed function that interpolates between adjacent control points (for more details, see <a href=https://en.wikipedia.org/wiki/B%C3%A9zier_curve>Wikipedia</a>).</p><p><img src=blade_model.jpg alt></p><h4 id=basic-geometry>Basic Geometry</h4><p>From the paper, a single grass blade can be defined as a Bezier curve with 3 control points: <code>v0</code>, <code>v1</code>, <code>v2</code>. <code>v0</code> is the base point specifying the 3D position of the base of the grass blade, <code>v1</code> is the guide for the curve that is always &ldquo;above&rdquo; <code>v0</code> and defines the blade&rsquo;s up direction, and <code>v2</code> is the control points where we execute all kinds of simulation forces. The paper provides a very detailed usage for tweaking basic 3D geometry shapes for rendering with Bezier curves (see Section 6.3 of paper).</p><h4 id=physics-simulation>Physics Simulation</h4><p>As for physical simulation, we define the following basic forces:</p><ul><li><strong>Gravity force</strong> that pulls <code>v2</code> to the ground, creating bends on the blade;</li><li><strong>Recovery force</strong> that tends to recover the up-straight pose of the blade;</li><li><strong>Wind force</strong> that produces random displacement on the tip of the blade (specifically, on <code>v2</code>).</li></ul><h4 id=blade-culling>Blade Culling</h4><p>Blade culling is an optimization technique that the paper mentions to improve FPS in real-time rendering. By culling we do not wish to render the grass blades that:</p><ul><li>are too far away;</li><li>are outside the camera&rsquo;s view frustum;</li><li>are not facing towards the camera.</li></ul><p>Culling tests are conducted in the compute shader so that the number of grass blades that need rendering varies with the position and orientation of the camera.</p><h3 id=visual-effects>Visual Effects</h3><p>The following images demonstrates effects due to different culling operations:</p><table><thead><tr><th style=text-align:center>Orientation Culling</th><th style=text-align:center>View-Frustum Culling</th><th style=text-align:center>Distance Culling</th></tr></thead><tbody><tr><td style=text-align:center><img src=orientation_culling.gif alt></td><td style=text-align:center><img src=view_frustum_culling.gif alt></td><td style=text-align:center><img src=distance_culling.gif alt></td></tr></tbody></table><p>The following image demonstrates the up-straight pose of the blade (no physics forces, no culling):</p><p><img src=blade_upstraight.png alt></p><h3 id=performance-analysis>Performance Analysis</h3><p>The following FPS tests on different culling options is conducted with <code>NUM_BLADES = 1 &lt;&lt; 18</code>:</p><p><img src=performance_analysis.png alt></p><p>We can see that orientation culling improves the rendering FPS the most, while all the others also have some improvements on the FPS.</p></div><div class="row pl-3 pr-3"><div class="col-md-6 share-buttons"></div><div class="col-md-6 btn-improve-page"><a href=https://github.com/shineyruan/shineyruan.github.io/edit/main/content/posts/Projects/565-vulkan-grass-rendering/index.md title="Improve this page" target=_blank rel=noopener><i class="fas fa-code-branch"></i>Improve this page</a></div></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/projects/565-final-project/ title="Volume Rendered ReSTIR in Vulkan" class="btn btn-outline-info"><div><i class="fas fa-chevron-circle-left"></i>Prev</div><div class=next-prev-text>Volume Rendered ReSTIR in Vulkan</div></a></div><div class="col-md-6 next-article"><a href=/posts/projects/f1tenth-labs/f1tenth-lab1/ title="My F1TENTH Journey — Lab 1, Introduction to ROS" class="btn btn-outline-info"><div>Next <i class="fas fa-chevron-circle-right"></i></div><div class=next-prev-text>My F1TENTH Journey — Lab 1, Introduction to ROS</div></a></div></div><hr></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><ul><li><a href=#highlights>Highlights</a></li><li><a href=#vulkan>Vulkan</a></li><li><a href=#responsive-real-time-grass-rendering-for-general-3d-sceneshttpswwwcgtuwienacatresearchpublications2017jahrmann-2017-rrtgjahrmann-2017-rrtg-draftpdf><a href=https://www.cg.tuwien.ac.at/research/publications/2017/JAHRMANN-2017-RRTG/JAHRMANN-2017-RRTG-draft.pdf>Responsive Real-Time Grass Rendering for General 3D Scenes</a></a><ul><li><a href=#basic-geometry>Basic Geometry</a></li><li><a href=#physics-simulation>Physics Simulation</a></li><li><a href=#blade-culling>Blade Culling</a></li></ul></li><li><a href=#visual-effects>Visual Effects</a></li><li><a href=#performance-analysis>Performance Analysis</a></li></ul></li></ul></nav></div></div></section></div><footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://zhihaoruan.xyz#about>About</a></li><li class=nav-item><a class=smooth-scroll href=https://zhihaoruan.xyz#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=https://zhihaoruan.xyz#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=https://zhihaoruan.xyz#education>Education</a></li><li class=nav-item><a class=smooth-scroll href=https://zhihaoruan.xyz#projects>Projects</a></li><li class=nav-item><a class=smooth-scroll href=https://zhihaoruan.xyz#recent-posts>Recent Posts</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=mailto:shineyruan@gmail.com target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span><span>shineyruan@gmail.com</span></a></li><li><a href=https://github.com/shineyruan target=_blank rel=noopener><span><i class="fab fa-github"></i></span><span>shineyruan</span></a></li></ul></div></div></div></footer><script type=text/javascript src=/js/jquery-3.4.1.min.js></script><script type=text/javascript src=/js/popper.min.js></script><script type=text/javascript src=/js/bootstrap.min.js></script><script type=text/javascript src=/js/navbar.js></script><script type=text/javascript src=/js/plyr.js></script><script type=text/javascript src=/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script><script src=/js/single.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>